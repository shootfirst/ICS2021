# 计算机系统

## 用户态内存分配

#### ptmalloc

##### 分类

+ fast bin

+ unordered bin

+ small bin

+ large bin

##### 过程

malloc：

+ 分配空间大于128kb，直接mmap匿名映射分配内存

+ 小于64b，则去fastbin中寻找

+ 小于512b，则去smallbin中寻找

+ 没有找到，则遍历fastbin，将相邻内存块合并加入unsortedbin，在unsortedbin中寻找，然后返回。遍历的时候，将内存加入small或者large

+ 从largebin中寻找，然后切割加入unsorted

+ 还是不够，看topchunk能不能满足，不能满足则调用brk系统调用扩容topchunk

free：

+ 回收空间大于128kb，直接回收操作系统

+ 和topchunk相邻，直接回收给topchunk

+ 小于64b，加入fastbin，检查是否能合并，能则加入unsortedbin，并且触发遍历和空闲chunk合并加入unsortedbin

+ 大于，加入unsortedbin，检查是否能合并


## 链接

#### 静态链接

+ 合并相似节

+ 收集各个源文件符号表，放入全局符号表中

+ 通过段内偏移确定所有符号的地址

+ 各个源文件的重定位表，从全局符号表中寻找出地址，填写

#### 动态链接

动态链接库必须是地址无关代码（因为它必须可以被映射到任意地址空间执行）

动态链接新增间接访问表got，调用外部跳转到got表表项所指向的地址

+ 静态链接

+ 装载可执行文件

+ 将控制权交由动态链接器，动态链接器首先自举，找到自己的 .dynamic 段，由此获得自己的符号表和重定位表，将自己所有的重定位入口都重定位

+ 通过可执行文件的dynamic段，加载所有动态链接库的dynamic段，最终加载完所有动态链接库

+ 装载所有动态链接库

+ 遍历可执行文件和动态链接库的重定位表，进行重定位（GOT表）

+ got表不一样，text段一样

+ 全局数据cow机制


## 计算机系统层次架构

## 软硬件接口

## 计算机启动

## 可执行文件

## 内存模型

## 操作系统对缓存的管理

## 用户态缓存






